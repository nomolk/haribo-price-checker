<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒãƒªãƒœãƒ¼ä¾¡æ ¼ãƒã‚§ãƒƒã‚«ãƒ¼</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¬ ãƒãƒªãƒœãƒ¼ä¾¡æ ¼ãƒã‚§ãƒƒã‚«ãƒ¼</h1>
            <p>Amazonã¨æ¥½å¤©ã®ãƒãƒªãƒœãƒ¼å•†å“ã‚’æ¯”è¼ƒã—ã¦ã€æœ€å®‰ä¾¡æ ¼ã‚’è¦‹ã¤ã‘ã‚ˆã†ï¼</p>
        </header>

        <main>
            <section class="price-list">
                <h2>å•†å“ä¸€è¦§</h2>
                <div class="controls">
                    <button id="refreshBtn" class="btn">æœ€æ–°æƒ…å ±ã‚’å–å¾—</button>
                </div>
                <div id="priceList" class="price-grid">
                    <!-- å•†å“æƒ…å ±ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                </div>
            </section>

            <section class="cheapest">
                <h2>æœ€å®‰å•†å“</h2>
                <div id="cheapestItem" class="cheapest-item">
                    <!-- æœ€å®‰å•†å“ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                </div>
            </section>
        </main>

        <footer>
            <p>â€» ä¾¡æ ¼ã¯24æ™‚é–“ä»¥å†…ã«æ›´æ–°ã•ã‚Œã¾ã™</p>
        </footer>
    </div>

    <script>
        // å•†å“æƒ…å ±ã‚’å–å¾—ã—ã¦è¡¨ç¤º
        async function fetchAndDisplayPrices() {
            try {
                const response = await fetch('/prices');
                const prices = await response.json();
                
                // å•†å“ä¸€è¦§ã‚’è¡¨ç¤º
                const priceList = document.getElementById('priceList');
                priceList.innerHTML = prices.map(item => `
                    <div class="price-card">
                        <img src="${item.item.Images.Primary.Medium?.URL || item.item.mediumImageUrl}" alt="${item.item.ItemInfo.Title.DisplayValue || item.item.itemName}">
                        <h3>${item.item.ItemInfo.Title.DisplayValue || item.item.itemName}</h3>
                        <p class="price">Â¥${item.price.toLocaleString()}</p>
                        <p class="weight">${item.weight}g</p>
                        <p class="price-per-gram">1gã‚ãŸã‚Š: Â¥${item.pricePerGram.toFixed(2)}</p>
                        <a href="${item.item.DetailPageURL || item.item.itemUrl}" target="_blank" class="btn">å•†å“ã‚’è¦‹ã‚‹</a>
                    </div>
                `).join('');

                // æœ€å®‰å•†å“ã‚’è¡¨ç¤º
                const cheapestResponse = await fetch('/cheapest');
                const cheapest = await cheapestResponse.json();
                const cheapestItem = document.getElementById('cheapestItem');
                cheapestItem.innerHTML = `
                    <div class="cheapest-card">
                        <img src="${cheapest.item.Images.Primary.Medium?.URL || cheapest.item.mediumImageUrl}" alt="${cheapest.item.ItemInfo.Title.DisplayValue || cheapest.item.itemName}">
                        <h3>${cheapest.item.ItemInfo.Title.DisplayValue || cheapest.item.itemName}</h3>
                        <p class="price">Â¥${cheapest.price.toLocaleString()}</p>
                        <p class="weight">${cheapest.weight}g</p>
                        <p class="price-per-gram">1gã‚ãŸã‚Š: Â¥${cheapest.pricePerGram.toFixed(2)}</p>
                        <a href="${cheapest.item.DetailPageURL || cheapest.item.itemUrl}" target="_blank" class="btn">å•†å“ã‚’è¦‹ã‚‹</a>
                    </div>
                `;
            } catch (error) {
                console.error('ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
                alert('ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
            }
        }

        // æœ€æ–°æƒ…å ±ã‚’å–å¾—ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.getElementById('refreshBtn').addEventListener('click', () => {
            fetchAndDisplayPrices();
        });

        // åˆæœŸè¡¨ç¤º
        fetchAndDisplayPrices();
    </script>
</body>
</html> 